# Expose your podman kube deployment with Inlets

## Provision your cloud infrastructure

The example provisions the cloud infrastructure on AWS

### Route53 hosted zone

For this demo you will need to have a pre-existing hosted zone on AWS route 53

### Run Terraform

```bash
cd terraform/
terraform apply -var route53_zone_name=< The name of your route53 hosted zone >
```

### Terraform outputs
The process will produce two outputs you will need in the next step
1. Public IP address of the EC2 instance
    ```bash
    terraform output -raw external_ip
    ```
2. Inlets-pro token.
    ```bash
    terraform output -raw token
    ```
### Troubleshooting your server

As part of the provisioning process, terraform creates a key pair to allow you to connect to your server.
Terraform will then store the private key `inlets.pem` in the terraform directory

## Run your local podman kube deployment

### Secrets
The deployment relies on two secrets defined in [pre-configured-secrets.yml](./quadlet/pre-configured-secrets.yml):

1. Set your inlets-pro license in the `stringData` of `inlets-license`
2. Set the token generated by terraform in the `stringData` of `inlets-server-token`
3. Create the secrets:
    ```bash
    podman kube play quadlet/pre-configured-secrets.yml
    ```

### Deployment
The deployment is defined in [inlets-ghost.yml](./quadlet/inlets-ghost.yml)
1. Set your FQDN in the `url` environment variable of the `ghost` container
2. Set the `url` parameter of the `command` of the `inlets` container to `wss://< EC2 Public IP >:8123`
3. Create the deployment
    ```bash
    podman kube play quadlet/inlets-ghost.yml
    ```

## Browse to your inlets server
https://< FQDN >